<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>晚自習福利社</title>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .food-card:active { transform: scale(0.98); transition: transform 0.1s; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 pb-24">
    <div class="fixed top-0 left-0 right-0 bg-white shadow-sm z-50 px-4 py-3 flex items-center justify-between">
        <h1 class="text-xl font-bold text-[#D70F64]"><i class="fa-solid fa-utensils mr-2"></i>晚自習福利社</h1>
        <div class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded-full"><i class="fa-solid fa-clock mr-1"></i>16:30 截止</div>
    </div>
    <div id="menu-container" class="mt-16 px-4 space-y-4"></div>
    <div class="fixed bottom-0 left-0 right-0 bg-white shadow-[0_-2px_10px_rgba(0,0,0,0.1)] p-4 z-50 border-t border-gray-100">
        <div class="flex justify-between items-center mb-3">
            <div class="text-sm text-gray-500"><i class="fa-solid fa-shopping-cart mr-1"></i><span id="total-qty">0</span> 份餐點</div>
            <div class="text-xl font-bold text-gray-800">$<span id="total-price">0</span></div>
        </div>
        <button onclick="submitOrder()" id="checkout-btn" class="w-full bg-[#D70F64] text-white font-bold py-3 rounded-lg opacity-50 cursor-not-allowed transition-all" disabled>下單預訂</button>
    </div>
<script>
        // 【請填入你的 LIFF ID】
        const MY_LIFF_ID = '你的_LIFF_ID_填在這裡'; 

        // 【請修改菜單】
        const menuData = [
            { id: 1, name: "雞肉飯", price: 55, img: "https://cdn-icons-png.flaticon.com/512/2619/2619574.png" },
            { id: 2, name: "大魯", price: 45, img: "https://cdn-icons-png.flaticon.com/512/1046/1046751.png" },
            { id: 3, name: "小魯", price: 35, img: "https://cdn-icons-png.flaticon.com/512/6978/6978255.png" },
            { id: 4, name: "大乾", price: 45, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
	    { id: 5, name: "滷蛋", price: 15, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
	    { id: 6, name: "蔥油餅", price: 35, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
	    { id: 7, name: "熱狗", price: 30, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
	    { id: 8, name: "肉羹麵", price: 45, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
	    { id: 9, name: "貢丸湯", price: 25, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
   	    { id: 10, name: "米糕", price: 25, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
	    { id: 11, name: "肉粽", price: 30, img: "https://cdn-icons-png.flaticon.com/512/3014/3014520.png" },
            { id: 12, name: "小乾", price: 35, img: "https://cdn-icons-png.flaticon.com/512/931/931949.png" }
        ];
let cart = {};
        window.onload = function() {
            renderMenu();
            if (typeof liff !== 'undefined') {
                liff.init({ liffId: MY_LIFF_ID }).then(() => { if (!liff.isLoggedIn()) liff.login(); }).catch((err) => { console.log(err); });
            }
        };
        function renderMenu() {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';
            menuData.forEach(item => {
                const qty = cart[item.id] || 0;
                const html = `
                <div class="bg-white p-4 rounded-xl shadow-sm flex items-center justify-between food-card border border-transparent hover:border-[#D70F64]">
                    <div class="flex items-center space-x-4 flex-1">
                        <img src="${item.img}" class="w-16 h-16 object-contain rounded-lg bg-gray-50 p-1">
                        <div>
                            <h3 class="font-bold text-gray-800 text-lg">${item.name}</h3>
                            <p class="text-gray-500 font-medium">$${item.price}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        ${qty > 0 ? `<button onclick="updateCart(${item.id}, -1)" class="w-8 h-8 rounded-full border border-gray-300 text-gray-600 flex items-center justify-center"><i class="fa-solid fa-minus text-xs"></i></button><span class="font-bold text-gray-800 w-4 text-center">${qty}</span>` : ''}
                        <button onclick="updateCart(${item.id}, 1)" class="w-8 h-8 rounded-full bg-[#D70F64] text-white flex items-center justify-center shadow-md"><i class="fa-solid fa-plus text-xs"></i></button>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
            updateSummary();
        }
        function updateCart(id, change) {
            if (!cart[id]) cart[id] = 0; cart[id] += change; if (cart[id] <= 0) delete cart[id]; renderMenu();
        }
        function updateSummary() {
            let totalQty = 0; let totalPrice = 0;
            for (const [id, qty] of Object.entries(cart)) {
                const item = menuData.find(i => i.id == id);
                if (item) { totalQty += qty; totalPrice += item.price * qty; }
            }
            document.getElementById('total-qty').innerText = totalQty;
            document.getElementById('total-price').innerText = totalPrice;
            const btn = document.getElementById('checkout-btn');
            if (totalQty > 0) {
                btn.disabled = false; btn.classList.remove('opacity-50', 'cursor-not-allowed'); btn.innerText = `下單預訂 ($${totalPrice})`;
            } else {
                btn.disabled = true; btn.classList.add('opacity-50', 'cursor-not-allowed'); btn.innerText = '下單預訂';
            }
        }
        function submitOrder() {
            if (!liff.isInClient()) { alert('請在 LINE App 中開啟！'); return; }
            let msg = "[新訂單]\n"; let totalPrice = 0;
            for (const [id, qty] of Object.entries(cart)) {
                const item = menuData.find(i => i.id == id); msg += `${item.name} x ${qty}\n`; totalPrice += item.price * qty;
            }
            msg += `總計：$${totalPrice}`;
            liff.sendMessages([{ type: 'text', text: msg }]).then(() => { alert('訂單已送出！'); liff.closeWindow(); }).catch((err) => { alert('傳送失敗'); });
        }
    </script>
</body>
</html>